CREATE TABLE PLANTILLA(
    HOSPITAL_COD NUMBER(2),
    SALA_COD NUMBER(2),
    EMPLEAT_NO NUMBER(4),
    COGNOM VARCHAR(15) NOT NULL,
    FUNCIO VARCHAR(10),
    TORN VARCHAR(1),
    SALARI NUMBER(10),
    CONSTRAINT PLANTILLA_PK PRIMARY KEY(EMPLEAT_NO),
    CONSTRAINT TORN_CH CHECK(TORN IN('M','T','N')),
    CONSTRAINT PLANTILLA_FK FOREIGN KEY(HOSPITAL_COD,SALA_COD) REFERENCES SALA(HOSPITAL_COD,SALA_COD)
);

CREATE INDEX HOSPITAL_NOM_INDEX ON HOSPITAL(NOM);

Insert into HOSPITAL values (13,'Bellvitge','Feixa Llarga s/n','964-4264',0);
Insert into HOSPITAL values (18,'Clinic','Villaroel 170','595-3111',0);
Insert into HOSPITAL values (22,'H del Mar','Psg Maritim','923-5411',0);
Insert into HOSPITAL values (45,'V. Hebron','Vall Hebron','597-1500',0);

INSERT INTO SALA VALUES (13,3,'Cures Intensives',21);
INSERT INTO SALA VALUES (13,6,'Psiquiatric',67);
INSERT INTO SALA VALUES (18,3,'Cures Intensives',10);
INSERT INTO SALA VALUES (18,4,'Cardiologia',53);
INSERT INTO SALA VALUES (22,1,'Recuperacio',10);
INSERT INTO SALA VALUES (22,6,'Psiquiatric',118);
INSERT INTO SALA VALUES (22,2,'Maternitat',34);
INSERT INTO SALA VALUES (45,4,'Cardiologia',55);
INSERT INTO SALA VALUES (45,1,'Recuperacio',13);
INSERT INTO SALA VALUES (45,2,'Maternitat',24);



INSERT INTO PLANTILLA VALUES(13,6,3754,'Diaz B.','Infermera','T',2262000);
INSERT INTO PLANTILLA VALUES(13,6,3106,'Hernandez J.','Infermer','T',2755000); 
INSERT INTO PLANTILLA VALUES(18,4,6357,'Karplus W.','Intern','T',3379000);
INSERT INTO PLANTILLA VALUES(22,6,1009,'Higueras D.','Infermera','T',2005000);
INSERT INTO PLANTILLA VALUES(22,6,8422,'Bocina G.','Infermer','M',1638000);
INSERT INTO PLANTILLA VALUES(22,2,9901,'Adams C.','Intern','M',2210000);
INSERT INTO PLANTILLA VALUES(22,1,6065,'Rivera G.','Infermera','N',1626000);
INSERT INTO PLANTILLA VALUES(22,1,7379,'Carlos R.','Infermera','T',2119000);
INSERT INTO PLANTILLA VALUES(45,4,1280,'Amiga R.','Intern','N',2210000);
INSERT INTO PLANTILLA VALUES(45,1,8526,'Frank H.','Infermera','T',2522000);



INSERT INTO MALALT VALUES(10995,'Laguna M.','Goya 20',to_date('1956-05-16','YYYY-MM-DD'),'H',280862482);
INSERT INTO MALALT VALUES(18004,'Serrano V.','Alcala 12',to_date('1960-05-21','YYYY-MM-DD'),'D',284991452);
INSERT INTO MALALT VALUES(14024,'Fernandez M.','Recoletos 50',to_date('1967-06-23','YYYY-MM-DD'),'D',321790059);
INSERT INTO MALALT VALUES(36658,'Domin S.','Mayor 71',to_date('1942-01-01','YYYY-MM-DD'),'H',160657471);
INSERT INTO MALALT VALUES(38702,'Neal R.','Orense 11',to_date('1940-06-18','YYYY-MM-DD'),'D',380010217);
INSERT INTO MALALT VALUES(39217,'Cervantes M.','Peron 38',to_date('1952-02-29','YYYY-MM-DD'),'H',440294390);
INSERT INTO MALALT VALUES(59076,'Miller G.','Lopez de Hoyos 2',to_date('1945-09-16','YYYY-MM-DD'),'D',311969044);
INSERT INTO MALALT VALUES(63827,'Ruiz P.','Esquerdo 103',to_date('1980-12-26','YYYY-MM-DD'),'H',100973253);
INSERT INTO MALALT VALUES(64823,'Fraser A.','Soto 3',to_date('1980-07-10','YYYY-MM-DD'),'D',285201776);
INSERT INTO MALALT VALUES(74835,'Benitez E.','Argentina 5',to_date('1957-10-05','YYYY-MM-DD'),'H',154811767);


INSERT INTO INGRESSOS VALUES(10995,13,3,1);
INSERT INTO INGRESSOS VALUES(18004,13,3,2);
INSERT INTO INGRESSOS VALUES(14024,13,3,3);
INSERT INTO INGRESSOS VALUES(36658,18,4,1);
INSERT INTO INGRESSOS VALUES(38702,18,4,2);
INSERT INTO INGRESSOS VALUES(39217,22,6,1);
INSERT INTO INGRESSOS VALUES(59076,22,6,2);
INSERT INTO INGRESSOS VALUES(63827,22,6,3);
INSERT INTO INGRESSOS VALUES(64823,22,2,1);



INSERT INTO DOCTOR VALUES(13,435,'Lopez A.','Cardiologia');
INSERT INTO DOCTOR VALUES(18,585,'Miller G.','Ginecologia');
INSERT INTO DOCTOR VALUES(18,982,'Cajal R.','Cardiologia');
INSERT INTO DOCTOR VALUES(22,453,'Galo D.','Pediatria');
INSERT INTO DOCTOR VALUES(22,398,'Best K.','Urologia');
INSERT INTO DOCTOR VALUES(22,386,'Cabeza D.','Psiquiatria');
INSERT INTO DOCTOR VALUES(45,607,'Nico P.','Pediatria');
INSERT INTO DOCTOR VALUES(45,522,'Adams C.','Neurologia');

INSERT INTO DOCTOR VALUES((SELECT HOSPITAL_COD FROM HOSPITAL WHERE UPPER(NOM) LIKE 'BELLVITGE'),666,'Galvez T.','Neumologia');

UPDATE HOSPITAL
SET QTAT_LLITS=(SELECT SUM(QTAT_LLITS) FROM SALA WHERE HOSPITAL_COD=HOSPITAL.HOSPITAL_COD);

SELECT * FROM SALA;
SELECT * FROM HOSPITAL;

/*Cuando la cagas con el update y actualizas SALA con los valores de HOSPITAL en lugar de hacerlo al rev√©s.
Con esta query se recuperan los valores de SALA del enunciado y se vuelven a insertar manualmente.*/
UPDATE SALA
SET QTAT_LLITS=CASE ROWNUM
WHEN 1 THEN 21
WHEN 2 THEN 67
WHEN 3 THEN 10
WHEN 4 THEN 53
WHEN 5 THEN 10
WHEN 6 THEN 118
WHEN 7 THEN 34
WHEN 8 THEN 55
WHEN 9 THEN 13
WHEN 10 THEN 24
END;

/*----------------------PART 2----------------------*/

SELECT HOSPITAL_COD,NOM,TELEFON FROM HOSPITAL ORDER BY NOM ASC;
SELECT HOSPITAL_COD,NOM,TELEFON FROM HOSPITAL WHERE UPPER(NOM) LIKE '_E%';
SELECT * FROM DOCTOR;
SELECT HOSPITAL_COD,(SELECT SALA_COD FROM SALA WHERE ),DOCTOR_NO,COGNOM FROM DOCTOR;